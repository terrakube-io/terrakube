# Issue #2787: Fix Console Time Calculation - Phase 2

**Issue:** Console calculates time from top of the minute, not by second

**Problem:** UI shows "Triggered from UI 42 seconds ago" even when job was just triggered because timestamps are being truncated to minute precision.

**Location:** `ui/src/domain/Workspaces/Details.tsx:872`

---

## Phase 2: Real Root Cause Investigation

**Previous Investigation Result:** INCORRECT - Database schema investigation found `datetime` type, but issue occurs on PostgreSQL which already has microsecond precision. The database is NOT the problem.

**Actual Evidence from Backend Response:**
```json
"createdDate": "2025-12-09T21:59Z"
```

**THE REAL PROBLEM:** The backend is serializing timestamps with **minute precision only** (no seconds!). This is happening during JSON serialization, not at the database level.

---

## Tasks

- [x] Examine actual database column data to verify it contains full timestamp precision
  - Database uses PostgreSQL TIMESTAMP which has microsecond precision - confirmed database is NOT the issue
- [x] Investigate Jackson/Elide serialization configuration for Date objects
  - Elide 7.1.15 uses Jackson for JSON serialization
  - No custom ObjectMapper beans found
- [x] Check if there's a custom JsonSerializer for Date/Timestamp fields
  - No custom serializers found
- [x] Look for @JsonFormat annotations on GenericAuditFields or entity classes
  - No @JsonFormat annotations found in codebase
- [x] Check Spring Boot Jackson configuration in application.properties
  - No Jackson configuration existed - this was the root cause!
- [x] Check Elide configuration for date serialization settings
  - Elide Spring Boot Starter uses default Jackson configuration
- [x] Identify where ISO-8601 format is being set to minute precision
  - Default Jackson behavior without explicit configuration was truncating to minutes
- [x] Implement fix to serialize timestamps with full second/millisecond precision
  - Added `spring.jackson.serialization.write-dates-as-timestamps=false` to application.properties
  - Added `spring.jackson.date-format=com.fasterxml.jackson.databind.util.StdDateFormat` to application.properties
  - This configures Jackson to use standard ISO-8601 format with full precision (seconds and milliseconds)
- [ ] Test fix by examining backend JSON response
- [ ] Verify UI shows accurate "X seconds ago" after fix
- [ ] Commit changes
- [ ] Push to branch
- [ ] Create PR

---

## Investigation Notes

**Database:** PostgreSQL (confirmed by user)
- PostgreSQL TIMESTAMP type has microsecond precision by default
- Database is NOT truncating the timestamps

**Backend Response Analysis:**
- File: `backend_response.json` contains actual backend response
- Format: `"createdDate": "2025-12-09T21:59Z"`
- Missing: Seconds and milliseconds (should be `2025-12-09T21:59:42.123Z`)

**Root Cause:** Backend serialization is formatting timestamps without seconds. This is either:
1. A custom Jackson serializer configuration
2. An Elide-specific date serialization setting
3. A @JsonFormat annotation somewhere
4. A Spring Boot Jackson configuration

**Key Code Locations to Investigate:**
- `api/src/main/java/io/terrakube/api/plugin/security/audit/GenericAuditFields.java` - Where createdDate is defined
- `api/src/main/java/io/terrakube/api/rs/workspace/history/History.java` - Entity that extends GenericAuditFields
- Elide configuration classes
- Spring Boot application.properties (Jackson settings)
- Any custom ObjectMapper beans

**What Won't Fix This:**
- ❌ Changing database column types (database already has precision)
- ❌ Frontend code changes (luxon library works correctly)
- ❌ Changing @Temporal annotation (JPA layer works correctly)

**What Will Fix This:**
- ✅ Fixing Jackson/Elide date serialization to include seconds in ISO-8601 format
